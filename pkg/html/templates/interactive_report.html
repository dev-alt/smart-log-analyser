<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}} - Smart Log Analyser Interactive Report</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js"></script>
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Custom Styles -->
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
        }
        
        .report-header {
            background: var(--primary-gradient);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        
        .metric-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 1rem;
            transition: transform 0.2s;
            cursor: pointer;
        }
        
        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }
        
        .metric-label {
            color: var(--secondary-color);
            font-size: 0.9rem;
            text-transform: uppercase;
        }
        
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            position: relative;
            height: 400px;
            overflow: hidden;
        }
        
        .chart-container canvas {
            max-width: 100% !important;
            max-height: 300px !important;
            width: auto !important;
            height: auto !important;
        }
        
        .chart-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #495057;
        }
        
        .nav-tabs .nav-link {
            border: none;
            color: var(--secondary-color);
            font-weight: 500;
            padding: 1rem 1.5rem;
            margin-right: 0.5rem;
            border-radius: 10px 10px 0 0;
        }
        
        .nav-tabs .nav-link.active {
            background: var(--primary-gradient);
            color: white;
        }
        
        .tab-content {
            background: white;
            border-radius: 0 10px 10px 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .security-excellent { color: var(--success-color); }
        .security-good { color: var(--info-color); }
        .security-fair { color: var(--warning-color); }
        .security-poor { color: var(--danger-color); }
        .security-critical { color: #721c24; }
        
        .table-container {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: #495057;
            border-bottom: 3px solid #667eea;
            padding-bottom: 0.5rem;
        }
        
        .clickable-row {
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .clickable-row:hover {
            background-color: rgba(102, 126, 234, 0.1);
        }
        
        .details-panel {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            display: none;
        }
        
        .badge-large {
            font-size: 0.9rem;
            padding: 0.5rem 0.75rem;
        }
        
        .filter-controls {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .status-badge {
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            margin: 0.1rem;
        }
        
        @media print {
            .no-print { display: none !important; }
            .chart-container { break-inside: avoid; }
            body { background: white !important; }
        }
    </style>
</head>
<body style="background-color: #f8f9fa;">

<!-- Header -->
<div class="report-header">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="mb-1">ðŸ“Š {{.Title}}</h1>
                <p class="mb-0 opacity-75">Smart Log Analyser Interactive Report</p>
            </div>
            <div class="col-md-4 text-md-end">
                <p class="mb-1">Generated: {{.GeneratedAt}}</p>
                <p class="mb-0">Analysis Period: {{.DateRange}}</p>
                <div class="mt-2">
                    <button class="btn btn-light btn-sm me-2" onclick="printReport()">
                        <i class="fas fa-print"></i> Print
                    </button>
                    <button class="btn btn-light btn-sm" onclick="exportData()">
                        <i class="fas fa-download"></i> Export
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <!-- Quick Overview Metrics -->
    <h2 class="section-title">ðŸ“‹ Quick Overview</h2>
    <div class="row">
        <div class="col-md-3">
            <div class="metric-card text-center" onclick="showTab('overview-tab')">
                <div class="metric-value">{{.TotalRequests}}</div>
                <div class="metric-label">Total Requests</div>
                <small class="text-muted">Click for details</small>
            </div>
        </div>
        <div class="col-md-3">
            <div class="metric-card text-center" onclick="showTab('traffic-tab')">
                <div class="metric-value">{{.UniqueIPs}}</div>
                <div class="metric-label">Unique IPs</div>
                <small class="text-muted">Click for analysis</small>
            </div>
        </div>
        <div class="col-md-3">
            <div class="metric-card text-center" onclick="showTab('performance-tab')">
                <div class="metric-value">{{.DataTransferred}}</div>
                <div class="metric-label">Data Transferred</div>
                <small class="text-muted">Click for breakdown</small>
            </div>
        </div>
        <div class="col-md-3">
            <div class="metric-card text-center" onclick="showTab('security-tab')">
                <div class="metric-value {{.SecurityClass}}">{{.SecurityScore}}</div>
                <div class="metric-label">Security Score</div>
                <small class="text-muted">Click for threats</small>
            </div>
        </div>
    </div>

    <!-- Interactive Tabbed Interface -->
    <div class="mt-4">
        <ul class="nav nav-tabs" id="analysisTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab">
                    <i class="fas fa-chart-bar"></i> Overview
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="traffic-tab" data-bs-toggle="tab" data-bs-target="#traffic" type="button" role="tab">
                    <i class="fas fa-network-wired"></i> Traffic Analysis
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="errors-tab" data-bs-toggle="tab" data-bs-target="#errors" type="button" role="tab">
                    <i class="fas fa-exclamation-triangle"></i> Error Analysis
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="performance-tab" data-bs-toggle="tab" data-bs-target="#performance" type="button" role="tab">
                    <i class="fas fa-tachometer-alt"></i> Performance
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="security-tab" data-bs-toggle="tab" data-bs-target="#security" type="button" role="tab">
                    <i class="fas fa-shield-alt"></i> Security
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="geographic-tab" data-bs-toggle="tab" data-bs-target="#geographic" type="button" role="tab">
                    <i class="fas fa-globe"></i> Geographic
                </button>
            </li>
        </ul>
        
        <div class="tab-content" id="analysisTabContent">
            <!-- Overview Tab -->
            <div class="tab-pane fade show active" id="overview" role="tabpanel">
                <h3><i class="fas fa-chart-bar text-primary"></i> Traffic Overview</h3>
                <div class="row">
                    <div class="col-md-6">
                        <div class="chart-container">
                            <h4 class="chart-title">Human vs Bot Traffic</h4>
                            <canvas id="trafficChart"></canvas>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="chart-container">
                            <h4 class="chart-title">Hourly Traffic Pattern</h4>
                            <canvas id="hourlyChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <h4 class="mt-4"><i class="fas fa-list"></i> Top URLs</h4>
                <div class="table-container">
                    <table class="table table-hover mb-0">
                        <thead class="table-dark">
                            <tr>
                                <th>Rank</th>
                                <th>URL</th>
                                <th>Requests</th>
                                <th>Percentage</th>
                                <th>Average Size</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{range $index, $url := .TopURLs}}
                            <tr class="clickable-row" onclick="toggleDetails('url-{{$index}}')">
                                <td>{{add $index 1}}</td>
                                <td><code>{{$url.URL}}</code></td>
                                <td>{{$url.Count}}</td>
                                <td><span class="badge bg-primary">{{$url.Percentage}}%</span></td>
                                <td>{{$url.AverageSize}}</td>
                            </tr>
                            <tr id="url-{{$index}}" class="details-panel" style="display: none;">
                                <td colspan="5">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <strong>URL Details:</strong><br>
                                            <small class="text-muted">Full path: <code>{{$url.URL}}</code></small><br>
                                            <small class="text-muted">Total requests: {{$url.Count}}</small><br>
                                            <small class="text-muted">Percentage of traffic: {{$url.Percentage}}%</small>
                                        </div>
                                        <div class="col-md-6">
                                            <strong>Performance:</strong><br>
                                            <small class="text-muted">Average size: {{$url.AverageSize}}</small><br>
                                            <small class="text-muted">Total transfer: {{$url.TotalTransfer}}</small>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            {{end}}
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Traffic Analysis Tab -->
            <div class="tab-pane fade" id="traffic" role="tabpanel">
                <h3><i class="fas fa-network-wired text-primary"></i> Traffic Analysis</h3>
                
                <div class="filter-controls">
                    <h5>Filters:</h5>
                    <div class="row">
                        <div class="col-md-4">
                            <select class="form-select" id="ipTypeFilter" onchange="filterIPs()">
                                <option value="">All IP Types</option>
                                <option value="Public">Public IPs</option>
                                <option value="Private">Private IPs</option>
                                <option value="CDN">CDN IPs</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <input type="number" class="form-control" placeholder="Min requests" id="minRequestsFilter" onchange="filterIPs()">
                        </div>
                        <div class="col-md-4">
                            <button class="btn btn-secondary" onclick="resetFilters()">Reset Filters</button>
                        </div>
                    </div>
                </div>

                <h4><i class="fas fa-server"></i> Top IP Addresses</h4>
                <div class="table-container">
                    <table class="table table-hover mb-0" id="ipsTable">
                        <thead class="table-dark">
                            <tr>
                                <th>Rank</th>
                                <th>IP Address</th>
                                <th>Requests</th>
                                <th>Percentage</th>
                                <th>Location</th>
                                <th>Type</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{range $index, $ip := .TopIPs}}
                            <tr class="clickable-row ip-row" data-ip-type="{{$ip.Type}}" data-requests="{{$ip.Count}}" onclick="toggleDetails('ip-{{$index}}')">
                                <td>{{add $index 1}}</td>
                                <td><code>{{$ip.IP}}</code></td>
                                <td>{{$ip.Count}}</td>
                                <td><span class="badge bg-info">{{$ip.Percentage}}%</span></td>
                                <td>{{$ip.Location}}</td>
                                <td><span class="badge bg-{{$ip.TypeClass}}">{{$ip.Type}}</span></td>
                                <td>
                                    <button class="btn btn-sm btn-outline-primary" onclick="showIPDetails('{{$ip.IP}}')">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr id="ip-{{$index}}" class="details-panel" style="display: none;">
                                <td colspan="7">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <strong>IP Information:</strong><br>
                                            <small class="text-muted">IP: <code>{{$ip.IP}}</code></small><br>
                                            <small class="text-muted">Type: {{$ip.Type}}</small><br>
                                            <small class="text-muted">Location: {{$ip.Location}}</small>
                                        </div>
                                        <div class="col-md-4">
                                            <strong>Traffic Statistics:</strong><br>
                                            <small class="text-muted">Total requests: {{$ip.Count}}</small><br>
                                            <small class="text-muted">Percentage: {{$ip.Percentage}}%</small><br>
                                            <small class="text-muted">Classification: {{$ip.Type}}</small>
                                        </div>
                                        <div class="col-md-4">
                                            <strong>Actions:</strong><br>
                                            <button class="btn btn-sm btn-info me-2" onclick="analyzeIP('{{$ip.IP}}')">
                                                <i class="fas fa-chart-line"></i> Analyze
                                            </button>
                                            <button class="btn btn-sm btn-warning" onclick="flagIP('{{$ip.IP}}')">
                                                <i class="fas fa-flag"></i> Flag
                                            </button>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            {{end}}
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Error Analysis Tab -->
            <div class="tab-pane fade" id="errors" role="tabpanel">
                <h3><i class="fas fa-exclamation-triangle text-danger"></i> Error Analysis</h3>
                
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="chart-container">
                            <h4 class="chart-title">Status Code Distribution</h4>
                            <canvas id="statusChart"></canvas>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="metric-card">
                            <h5>Error Summary</h5>
                            <div class="row">
                                <div class="col-6">
                                    <div class="text-center">
                                        <div class="metric-value text-warning" id="totalErrors">{{len .ErrorURLs}}</div>
                                        <div class="metric-label">Error URLs</div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="text-center">
                                        <div class="metric-value text-danger" id="errorRate">0.0%</div>
                                        <div class="metric-label">Error Rate</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="filter-controls">
                    <h5>Error Filters:</h5>
                    <div class="row">
                        <div class="col-md-3">
                            <select class="form-select" id="statusCodeFilter" onchange="filterErrors()">
                                <option value="">All Status Codes</option>
                                <option value="400">400 - Bad Request</option>
                                <option value="404">404 - Not Found</option>
                                <option value="500">500 - Server Error</option>
                                <option value="499">499 - Client Closed</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <input type="number" class="form-control" placeholder="Min error count" id="minErrorsFilter" onchange="filterErrors()">
                        </div>
                        <div class="col-md-3">
                            <input type="text" class="form-control" placeholder="Search URL" id="urlSearchFilter" onchange="filterErrors()">
                        </div>
                        <div class="col-md-3">
                            <button class="btn btn-secondary" onclick="resetErrorFilters()">Reset</button>
                        </div>
                    </div>
                </div>

                {{if .ErrorURLs}}
                <h4><i class="fas fa-bug"></i> Error Details</h4>
                <div class="table-container">
                    <table class="table table-hover mb-0" id="errorsTable">
                        <thead class="table-dark">
                            <tr>
                                <th>URL</th>
                                <th>Error Count</th>
                                <th>Status Codes</th>
                                <th>Error Rate</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{range $index, $error := .ErrorURLs}}
                            <tr class="clickable-row error-row" data-url="{{$error.URL}}" data-count="{{$error.ErrorCount}}" onclick="toggleDetails('error-{{$index}}')">
                                <td><code>{{$error.URL}}</code></td>
                                <td><span class="badge bg-danger">{{$error.ErrorCount}}</span></td>
                                <td>
                                    {{$statusCodes := $error.StatusCodes}}
                                    {{range $code := (split $statusCodes "/")}}
                                        <span class="status-badge bg-danger">{{$code}}</span>
                                    {{end}}
                                </td>
                                <td><span class="badge badge-large bg-warning">{{$error.ErrorRate}}%</span></td>
                                <td>
                                    <button class="btn btn-sm btn-outline-info" onclick="analyzeError('{{$error.URL}}')">
                                        <i class="fas fa-search-plus"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr id="error-{{$index}}" class="details-panel" style="display: none;">
                                <td colspan="5">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <strong>Error Details:</strong><br>
                                            <small class="text-muted">URL: <code>{{$error.URL}}</code></small><br>
                                            <small class="text-muted">Total errors: {{$error.ErrorCount}}</small><br>
                                            <small class="text-muted">Error rate: {{$error.ErrorRate}}%</small>
                                        </div>
                                        <div class="col-md-6">
                                            <strong>Status Codes:</strong><br>
                                            <small class="text-muted">Codes: {{$error.StatusCodes}}</small><br>
                                            <div class="mt-2">
                                                <button class="btn btn-sm btn-primary me-2" onclick="viewErrorLogs('{{$error.URL}}')">
                                                    <i class="fas fa-file-alt"></i> View Logs
                                                </button>
                                                <button class="btn btn-sm btn-success" onclick="fixSuggestion('{{$error.URL}}')">
                                                    <i class="fas fa-tools"></i> Fix Suggestion
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            {{end}}
                        </tbody>
                    </table>
                </div>
                {{else}}
                <div class="alert alert-success" role="alert">
                    <i class="fas fa-check-circle"></i> <strong>Great!</strong> No significant errors detected in your logs.
                </div>
                {{end}}
            </div>

            <!-- Performance Tab -->
            <div class="tab-pane fade" id="performance" role="tabpanel">
                <h3><i class="fas fa-tachometer-alt text-success"></i> Performance Analysis</h3>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="chart-container">
                            <h4 class="chart-title">Response Size Distribution</h4>
                            <canvas id="responseSizeChart"></canvas>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="metric-card">
                            <h5>Performance Metrics</h5>
                            <div class="row">
                                <div class="col-6">
                                    <small class="text-muted">P50 Size</small>
                                    <div class="h5 text-info">{{printf "%.1f KB" .P50Size}}</div>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">P95 Size</small>
                                    <div class="h5 text-warning">{{printf "%.1f KB" .P95Size}}</div>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">P99 Size</small>
                                    <div class="h5 text-danger">{{printf "%.1f KB" .P99Size}}</div>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">Average Size</small>
                                    <div class="h5 text-primary">{{printf "%.1f KB" .AvgSize}}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> 
                    <strong>Performance Insights:</strong> 
                    Based on response sizes and request patterns, your server appears to be performing well. 
                    Consider caching for frequently requested resources.
                </div>
            </div>

            <!-- Security Tab -->
            <div class="tab-pane fade" id="security" role="tabpanel">
                <h3><i class="fas fa-shield-alt text-primary"></i> Security Analysis</h3>
                
                <div class="row mb-4">
                    <div class="col-md-4">
                        <div class="metric-card text-center">
                            <div class="metric-value {{.SecurityClass}}">{{.SecurityScore}}</div>
                            <div class="metric-label">Security Score</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="metric-card text-center">
                            <div class="metric-value text-warning">{{.TotalThreats}}</div>
                            <div class="metric-label">Threats Detected</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="metric-card text-center">
                            <div class="metric-value text-danger">{{.SuspiciousIPs}}</div>
                            <div class="metric-label">Suspicious IPs</div>
                        </div>
                    </div>
                </div>

                <div class="alert alert-{{if lt (printf "%s" .SecurityScore | atoi) 70}}danger{{else if lt (printf "%s" .SecurityScore | atoi) 85}}warning{{else}}success{{end}}">
                    <i class="fas fa-{{if lt (printf "%s" .SecurityScore | atoi) 70}}exclamation-triangle{{else if lt (printf "%s" .SecurityScore | atoi) 85}}info-circle{{else}}check-circle{{end}}"></i> 
                    <strong>Security Status:</strong> 
                    {{if lt (printf "%s" .SecurityScore | atoi) 70}}
                        High risk detected. Multiple security issues need immediate attention.
                    {{else if lt (printf "%s" .SecurityScore | atoi) 85}}
                        Moderate security concerns. Review recommended actions.
                    {{else}}
                        Good security posture. Continue monitoring for threats.
                    {{end}}
                </div>

                <h4><i class="fas fa-user-secret"></i> Security Recommendations</h4>
                <div class="list-group">
                    <div class="list-group-item">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">Monitor Failed Login Attempts</h6>
                            <span class="badge bg-warning">Medium Priority</span>
                        </div>
                        <p class="mb-1">Review 401/403 errors for potential brute force attacks.</p>
                    </div>
                    <div class="list-group-item">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">Secure Sensitive Files</h6>
                            <span class="badge bg-danger">High Priority</span>
                        </div>
                        <p class="mb-1">Block access to configuration files like .env, .git/config.</p>
                    </div>
                    <div class="list-group-item">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">Rate Limiting</h6>
                            <span class="badge bg-info">Low Priority</span>
                        </div>
                        <p class="mb-1">Implement rate limiting to prevent abuse from high-traffic IPs.</p>
                    </div>
                </div>
            </div>

            <!-- Geographic Tab -->
            <div class="tab-pane fade" id="geographic" role="tabpanel">
                <h3><i class="fas fa-globe text-success"></i> Geographic Analysis</h3>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="chart-container">
                            <h4 class="chart-title">Traffic by Region</h4>
                            <canvas id="geoChart"></canvas>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="chart-container">
                            <h4 class="chart-title">File Type Distribution</h4>
                            <canvas id="fileTypeChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-info">
                    <i class="fas fa-map-marker-alt"></i> 
                    <strong>Geographic Insights:</strong> 
                    Traffic distribution shows {{if gt (len .GeoLabels) 2}}diverse{{else}}concentrated{{end}} geographic patterns. 
                    Monitor for unusual geographic spikes that might indicate attacks.
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="text-center mt-5 mb-4 text-muted">
        <p>Generated by Smart Log Analyser v{{.Version}} â€¢ Report ID: {{.ReportID}}</p>
        <p class="small">This interactive report contains analysis of {{.TotalRequests}} log entries</p>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Chart and Interactive JavaScript -->
<script>
    // Wait for DOM and Chart.js to load
    document.addEventListener('DOMContentLoaded', function() {
        if (typeof Chart === 'undefined') {
            console.error('Chart.js failed to load');
            return;
        }
        
        Chart.defaults.responsive = true;
        Chart.defaults.maintainAspectRatio = false;
        
        initializeCharts();
        initializeInteractivity();
    });

    function initializeCharts() {
        // Traffic Chart
        const trafficCtx = document.getElementById('trafficChart').getContext('2d');
        new Chart(trafficCtx, {
            type: 'doughnut',
            data: {
                labels: ['Human Traffic', 'Bot Traffic'],
                datasets: [{
                    data: [{{.HumanTraffic}}, {{.BotTraffic}}],
                    backgroundColor: ['#28a745', '#ffc107'],
                    borderWidth: 2,
                    borderColor: '#fff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom' }
                }
            }
        });

        // Hourly Chart
        const hourlyCtx = document.getElementById('hourlyChart').getContext('2d');
        new Chart(hourlyCtx, {
            type: 'line',
            data: {
                labels: [{{range .HourlyLabels}}"{{.}}",{{end}}],
                datasets: [{
                    label: 'Requests',
                    data: [{{range .HourlyData}}{{.}},{{end}}],
                    borderColor: '#667eea',
                    backgroundColor: 'rgba(102, 126, 234, 0.1)',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });

        // Status Code Chart
        const statusCtx = document.getElementById('statusChart').getContext('2d');
        new Chart(statusCtx, {
            type: 'pie',
            data: {
                labels: [{{range .StatusLabels}}"{{.}}",{{end}}],
                datasets: [{
                    data: [{{range .StatusData}}{{.}},{{end}}],
                    backgroundColor: ['#28a745', '#17a2b8', '#ffc107', '#dc3545'],
                    borderWidth: 2,
                    borderColor: '#fff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom' }
                }
            }
        });

        // Response Size Chart
        const responseSizeCtx = document.getElementById('responseSizeChart').getContext('2d');
        new Chart(responseSizeCtx, {
            type: 'bar',
            data: {
                labels: ['P50', 'P95', 'P99', 'Average'],
                datasets: [{
                    label: 'Response Size (KB)',
                    data: [{{.P50Size}}, {{.P95Size}}, {{.P99Size}}, {{.AvgSize}}],
                    backgroundColor: ['#17a2b8', '#ffc107', '#fd7e14', '#6f42c1'],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });

        // Geographic Chart
        const geoCtx = document.getElementById('geoChart').getContext('2d');
        new Chart(geoCtx, {
            type: 'bar',
            data: {
                labels: [{{range .GeoLabels}}"{{.}}",{{end}}],
                datasets: [{
                    label: 'Requests',
                    data: [{{range .GeoData}}{{.}},{{end}}],
                    backgroundColor: '#667eea',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });

        // File Type Chart
        const fileTypeCtx = document.getElementById('fileTypeChart').getContext('2d');
        new Chart(fileTypeCtx, {
            type: 'horizontalBar',
            data: {
                labels: [{{range .FileTypeLabels}}"{{.}}",{{end}}],
                datasets: [{
                    label: 'Requests',
                    data: [{{range .FileTypeData}}{{.}},{{end}}],
                    backgroundColor: [
                        '#e74c3c', '#3498db', '#f39c12', 
                        '#2ecc71', '#9b59b6', '#1abc9c'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { beginAtZero: true }
                }
            }
        });
    }

    function initializeInteractivity() {
        // Calculate and display error rate
        const totalRequests = {{.TotalRequests | replace "," ""}};
        const errorURLs = {{len .ErrorURLs}};
        const errorRate = errorURLs > 0 ? ((errorURLs * 100) / totalRequests).toFixed(2) : '0.0';
        document.getElementById('errorRate').textContent = errorRate + '%';
    }

    // Interactive Functions
    function showTab(tabId) {
        const tab = document.getElementById(tabId);
        if (tab) {
            const tabTrigger = new bootstrap.Tab(tab);
            tabTrigger.show();
        }
    }

    function toggleDetails(elementId) {
        const element = document.getElementById(elementId);
        if (element) {
            element.style.display = element.style.display === 'none' ? 'table-row' : 'none';
        }
    }

    function filterIPs() {
        const typeFilter = document.getElementById('ipTypeFilter').value;
        const minRequests = document.getElementById('minRequestsFilter').value;
        const rows = document.querySelectorAll('.ip-row');
        
        rows.forEach(row => {
            const ipType = row.dataset.ipType;
            const requests = parseInt(row.dataset.requests);
            
            const typeMatch = !typeFilter || ipType === typeFilter;
            const requestsMatch = !minRequests || requests >= parseInt(minRequests);
            
            row.style.display = (typeMatch && requestsMatch) ? 'table-row' : 'none';
        });
    }

    function filterErrors() {
        const statusFilter = document.getElementById('statusCodeFilter').value;
        const minErrors = document.getElementById('minErrorsFilter').value;
        const urlSearch = document.getElementById('urlSearchFilter').value.toLowerCase();
        const rows = document.querySelectorAll('.error-row');
        
        rows.forEach(row => {
            const url = row.dataset.url.toLowerCase();
            const count = parseInt(row.dataset.count);
            const statusCodes = row.cells[2].textContent;
            
            const statusMatch = !statusFilter || statusCodes.includes(statusFilter);
            const countMatch = !minErrors || count >= parseInt(minErrors);
            const urlMatch = !urlSearch || url.includes(urlSearch);
            
            row.style.display = (statusMatch && countMatch && urlMatch) ? 'table-row' : 'none';
        });
    }

    function resetFilters() {
        document.getElementById('ipTypeFilter').value = '';
        document.getElementById('minRequestsFilter').value = '';
        filterIPs();
    }

    function resetErrorFilters() {
        document.getElementById('statusCodeFilter').value = '';
        document.getElementById('minErrorsFilter').value = '';
        document.getElementById('urlSearchFilter').value = '';
        filterErrors();
    }

    // Threat Intelligence Database
    const threatIntelligence = {
        // WordPress vulnerabilities and probes
        '/wp-admin/': 'WordPress admin panel access attempt - common target for brute force attacks',
        '/wp-login.php': 'WordPress login page access - potential credential stuffing or brute force attempt',
        '/wp-cron.php': 'WordPress cron job endpoint - legitimate if from site itself, suspicious if external',
        '/wp-content/': 'WordPress content directory access - could indicate plugin/theme vulnerability probing',
        '/wp-config.php': 'CRITICAL: WordPress configuration file access attempt - contains database credentials',
        '/wp-includes/': 'WordPress core files access - potential vulnerability scanning',
        
        // Common vulnerability probes
        '/.env': 'CRITICAL: Environment file access attempt - contains sensitive configuration and secrets',
        '/.git/config': 'CRITICAL: Git configuration exposure attempt - reveals repository structure and possibly credentials',
        '/admin': 'Administrative interface probe - common target for unauthorized access attempts',
        '/phpmyadmin': 'phpMyAdmin access attempt - database administration tool, high-value target',
        '/xmlrpc.php': 'WordPress XML-RPC endpoint - commonly exploited for DDoS amplification attacks',
        
        // File/directory probes
        '/.well-known/': 'Well-known directory probe - could be legitimate (SSL certs) or reconnaissance',
        '/robots.txt': 'Robots.txt file access - often legitimate, but also used for reconnaissance',
        '/sitemap.xml': 'Sitemap access - usually legitimate SEO, but also used for site mapping by attackers',
        '/favicon.ico': 'Favicon request - typically benign, but high 404 rates may indicate bot activity',
        
        // Admin/management interfaces
        '/admin/': 'Admin panel access attempt - generic administrative interface probe',
        '/administrator/': 'Administrator interface probe - common on various CMS platforms',
        '/manager/': 'Management interface probe - often Tomcat or similar application servers',
        '/console/': 'System console access attempt - administrative interface targeting',
        
        // API endpoints
        '/api/': 'API endpoint access - legitimate for applications, but monitor for unusual patterns',
        '/graphql': 'GraphQL endpoint access - modern API technology, monitor for injection attempts',
        '/rest/': 'REST API access - check for unauthorized data access patterns',
        
        // Shell/backdoor attempts
        '/shell.php': 'CRITICAL: Web shell access attempt - indicates potential compromise or probing',
        '/backdoor.php': 'CRITICAL: Backdoor access attempt - malicious file execution attempt',
        '/cmd.php': 'CRITICAL: Command execution script access - potential remote code execution attempt',
        
        // Exploit attempts
        '/vendor/': 'Vendor directory access - could indicate dependency vulnerability scanning',
        '/node_modules/': 'Node.js modules access - potential supply chain attack vector probing',
        '/.aws/': 'CRITICAL: AWS credentials directory access attempt',
        '/.docker/': 'Docker configuration access attempt - container security probe'
    };

    const ipIntelligence = {
        // CDN/Legitimate services
        'cloudflare': {
            ranges: ['172.69.', '172.70.', '172.71.', '108.162.', '162.158.'],
            description: 'Cloudflare CDN - Traffic proxied through Cloudflare network',
            threat_level: 'LOW',
            analysis: 'Legitimate CDN traffic, but monitor for unusual patterns as attackers can use CDN services'
        },
        'private': {
            ranges: ['192.168.', '10.', '172.16.', '172.17.', '172.18.', '172.19.', '172.20.', '172.21.', '172.22.', '172.23.', '172.24.', '172.25.', '172.26.', '172.27.', '172.28.', '172.29.', '172.30.', '172.31.'],
            description: 'Private/Internal Network - RFC 1918 private address space',
            threat_level: 'LOW',
            analysis: 'Internal network traffic - generally trusted but monitor for lateral movement patterns'
        }
    };

    const userAgentPatterns = {
        'WordPress': 'WordPress site making legitimate requests (wp-cron, updates, etc.)',
        'curl': 'Command-line tool - could be legitimate automation or reconnaissance',
        'python-requests': 'Python script making requests - often legitimate but monitor patterns',
        'bot': 'Automated bot activity - check if legitimate search engine or malicious scraper',
        'crawler': 'Web crawler activity - verify against legitimate search engine crawlers',
        'scanner': 'Security scanner detected - likely vulnerability assessment tool',
        'Mozilla/5.0': 'Standard browser user agent - legitimate unless exhibiting bot-like behavior'
    };

    // Log Analysis Functions
    function showIPDetails(ip) {
        const analysis = analyzeIPThreatLevel(ip);
        const modal = createAnalysisModal('IP Address Analysis', `
            <div class="ip-analysis">
                <h5><i class="fas fa-network-wired"></i> IP Address: <code>${ip}</code></h5>
                
                <div class="row mt-3">
                    <div class="col-md-6">
                        <h6><i class="fas fa-shield-alt"></i> Threat Assessment</h6>
                        <div class="alert alert-${analysis.alertClass}">
                            <strong>Risk Level:</strong> ${analysis.threat_level}<br>
                            <strong>Classification:</strong> ${analysis.classification}
                        </div>
                        <p><strong>Analysis:</strong> ${analysis.analysis}</p>
                    </div>
                    
                    <div class="col-md-6">
                        <h6><i class="fas fa-info-circle"></i> Technical Details</h6>
                        <ul class="list-unstyled">
                            <li><strong>Network Type:</strong> ${analysis.network_type}</li>
                            <li><strong>Geographic Region:</strong> ${analysis.region}</li>
                            <li><strong>ISP/Organization:</strong> ${analysis.organization}</li>
                        </ul>
                    </div>
                </div>
                
                <h6><i class="fas fa-chart-line"></i> Behavioral Patterns</h6>
                <div class="behavior-analysis">
                    <p>â€¢ <strong>Request Frequency:</strong> Analyze timing patterns for bot detection</p>
                    <p>â€¢ <strong>User Agent Consistency:</strong> Check for rotating or suspicious user agents</p>
                    <p>â€¢ <strong>Endpoint Targeting:</strong> Monitor accessed URLs for vulnerability scanning patterns</p>
                    <p>â€¢ <strong>Error Rates:</strong> High 404 rates may indicate reconnaissance activity</p>
                </div>
            </div>
        `);
        
        document.body.appendChild(modal);
    }

    function analyzeIP(ip) {
        const entries = findLogEntriesByIP(ip);
        const patterns = analyzeRequestPatterns(entries);
        
        const modal = createAnalysisModal('Detailed IP Behavioral Analysis', `
            <div class="behavioral-analysis">
                <h5><i class="fas fa-microscope"></i> Behavioral Analysis for <code>${ip}</code></h5>
                
                <div class="row mt-3">
                    <div class="col-md-4">
                        <div class="metric-card">
                            <h6>Request Volume</h6>
                            <div class="metric-value">${patterns.total_requests}</div>
                            <small class="text-muted">Total requests identified</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="metric-card">
                            <h6>Time Span</h6>
                            <div class="metric-value">${patterns.time_span}</div>
                            <small class="text-muted">Activity duration</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="metric-card">
                            <h6>Success Rate</h6>
                            <div class="metric-value">${patterns.success_rate}%</div>
                            <small class="text-muted">2xx responses</small>
                        </div>
                    </div>
                </div>
                
                <h6 class="mt-4"><i class="fas fa-target"></i> Access Patterns</h6>
                <div class="pattern-analysis">
                    ${patterns.top_urls.map(url => `
                        <div class="pattern-item">
                            <code>${url.path}</code>
                            <span class="badge bg-info">${url.count} requests</span>
                            <span class="analysis-note">${getThreatAnalysis(url.path)}</span>
                        </div>
                    `).join('')}
                </div>
                
                <h6 class="mt-4"><i class="fas fa-exclamation-triangle"></i> Suspicious Indicators</h6>
                <div class="threat-indicators">
                    ${patterns.suspicious_patterns.map(indicator => `
                        <div class="alert alert-${indicator.severity === 'HIGH' ? 'danger' : 'warning'}">
                            <strong>${indicator.type}:</strong> ${indicator.description}
                        </div>
                    `).join('')}
                </div>
            </div>
        `);
        
        document.body.appendChild(modal);
    }

    function flagIP(ip) {
        const analysis = analyzeIPThreatLevel(ip);
        const modal = createAnalysisModal('IP Flagging Analysis', `
            <div class="flagging-analysis">
                <h5><i class="fas fa-flag text-warning"></i> Security Assessment for <code>${ip}</code></h5>
                
                <div class="alert alert-info">
                    <h6><i class="fas fa-info-circle"></i> Analysis Purpose</h6>
                    <p>This analysis helps security teams understand threat patterns and adjust monitoring rules. 
                    No direct actions are taken on the server infrastructure.</p>
                </div>
                
                <h6>Risk Assessment Summary</h6>
                <div class="risk-summary">
                    <div class="row">
                        <div class="col-md-6">
                            <strong>Current Threat Level:</strong> 
                            <span class="badge bg-${analysis.alertClass}">${analysis.threat_level}</span>
                        </div>
                        <div class="col-md-6">
                            <strong>Recommended Action:</strong> 
                            <span class="text-${analysis.alertClass}">${analysis.recommendation}</span>
                        </div>
                    </div>
                </div>
                
                <h6 class="mt-3">Monitoring Recommendations</h6>
                <ul>
                    <li><strong>Enhanced Logging:</strong> Monitor this IP for unusual request patterns</li>
                    <li><strong>Rate Limiting:</strong> Consider implementing request throttling if abuse detected</li>
                    <li><strong>Pattern Analysis:</strong> Look for similar behavioral patterns from other IPs</li>
                    <li><strong>Threat Intelligence:</strong> Cross-reference with external threat feeds</li>
                </ul>
            </div>
        `);
        
        document.body.appendChild(modal);
    }

    function analyzeError(url) {
        const errorAnalysis = getURLThreatAnalysis(url);
        
        const modal = createAnalysisModal('Error Pattern Analysis', `
            <div class="error-analysis">
                <h5><i class="fas fa-bug"></i> Error Analysis for <code>${url}</code></h5>
                
                <div class="alert alert-${errorAnalysis.severity.toLowerCase()}">
                    <h6><i class="fas fa-exclamation-triangle"></i> Threat Assessment</h6>
                    <p><strong>Risk Level:</strong> ${errorAnalysis.severity}</p>
                    <p><strong>Pattern Type:</strong> ${errorAnalysis.pattern_type}</p>
                    <p><strong>Analysis:</strong> ${errorAnalysis.description}</p>
                </div>
                
                <h6>Technical Analysis</h6>
                <div class="technical-details">
                    <p><strong>Common Attack Vector:</strong> ${errorAnalysis.attack_vector}</p>
                    <p><strong>Typical Intent:</strong> ${errorAnalysis.intent}</p>
                    <p><strong>Frequency Significance:</strong> ${errorAnalysis.frequency_analysis}</p>
                </div>
                
                <h6>Related Indicators</h6>
                <div class="indicators">
                    ${errorAnalysis.related_indicators.map(indicator => `
                        <div class="indicator-item">
                            <i class="fas fa-arrow-right text-primary"></i> ${indicator}
                        </div>
                    `).join('')}
                </div>
                
                <h6 class="mt-3">Security Context</h6>
                <div class="security-context">
                    <p>${errorAnalysis.security_context}</p>
                </div>
            </div>
        `);
        
        document.body.appendChild(modal);
    }

    function viewErrorLogs(url) {
        const logEntries = generateSampleLogEntries(url);
        
        const modal = createAnalysisModal('Log Entries Analysis', `
            <div class="log-analysis">
                <h5><i class="fas fa-file-alt"></i> Log Entries for <code>${url}</code></h5>
                
                <div class="alert alert-info">
                    <h6><i class="fas fa-info-circle"></i> Log Analysis Context</h6>
                    <p>These represent typical log patterns for this URL type. Actual log correlation 
                    would analyze timestamps, IP patterns, and user agent consistency.</p>
                </div>
                
                <h6>Sample Log Entries Pattern</h6>
                <div class="log-entries">
                    ${logEntries.map(entry => `
                        <div class="log-entry">
                            <div class="log-line">
                                <code>${entry.log_line}</code>
                            </div>
                            <div class="log-analysis-note">
                                <small class="text-muted">
                                    <i class="fas fa-search"></i> ${entry.analysis}
                                </small>
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                <h6 class="mt-3">Pattern Analysis</h6>
                <ul>
                    <li><strong>Timing Patterns:</strong> Analyze request intervals for automation detection</li>
                    <li><strong>User Agent Analysis:</strong> Check for consistent or rotating user agents</li>
                    <li><strong>Referrer Analysis:</strong> Examine request origins and referral patterns</li>
                    <li><strong>Response Size Patterns:</strong> Look for consistent response sizes indicating scripted access</li>
                </ul>
            </div>
        `);
        
        document.body.appendChild(modal);
    }

    // Helper Functions for Analysis
    function analyzeIPThreatLevel(ip) {
        // Check against known CDN/service ranges
        for (const [service, info] of Object.entries(ipIntelligence)) {
            for (const range of info.ranges) {
                if (ip.startsWith(range)) {
                    return {
                        threat_level: info.threat_level,
                        classification: info.description,
                        analysis: info.analysis,
                        network_type: service === 'cloudflare' ? 'CDN/Proxy' : 'Private Network',
                        region: service === 'cloudflare' ? 'Global CDN' : 'Local Network',
                        organization: service === 'cloudflare' ? 'Cloudflare Inc.' : 'Internal',
                        alertClass: info.threat_level === 'LOW' ? 'success' : 'warning',
                        recommendation: 'Monitor for unusual patterns'
                    };
                }
            }
        }
        
        // Default public IP analysis
        return {
            threat_level: 'MEDIUM',
            classification: 'Public Internet IP',
            analysis: 'External IP address - requires behavioral analysis to determine threat level',
            network_type: 'Public Internet',
            region: 'Unknown (requires GeoIP lookup)',
            organization: 'Unknown ISP',
            alertClass: 'warning',
            recommendation: 'Enhanced monitoring recommended'
        };
    }

    function getThreatAnalysis(url) {
        // Exact matches first
        if (threatIntelligence[url]) {
            return threatIntelligence[url];
        }
        
        // Pattern matching
        for (const [pattern, description] of Object.entries(threatIntelligence)) {
            if (url.includes(pattern)) {
                return description;
            }
        }
        
        // Default analysis based on patterns
        if (url.includes('admin') || url.includes('login')) {
            return 'Administrative interface access - potential unauthorized access attempt';
        }
        if (url.includes('.php')) {
            return 'PHP script access - monitor for injection attempts or vulnerability probes';
        }
        if (url.includes('wp-')) {
            return 'WordPress-related request - monitor for CMS-specific attacks';
        }
        if (url.includes('api')) {
            return 'API endpoint access - check for unauthorized data access or injection attempts';
        }
        
        return 'Standard web request - monitor frequency and patterns for anomalies';
    }

    function getURLThreatAnalysis(url) {
        const baseAnalysis = getThreatAnalysis(url);
        
        // Determine severity and additional context
        if (url.includes('wp-config') || url.includes('.env') || url.includes('.git')) {
            return {
                severity: 'CRITICAL',
                pattern_type: 'Configuration File Access',
                description: baseAnalysis,
                attack_vector: 'Information Disclosure',
                intent: 'Credential harvesting and system reconnaissance',
                frequency_analysis: 'Single attempts may indicate targeted attacks, multiple attempts suggest automated scanning',
                related_indicators: [
                    'Check for other configuration file access attempts from same IP',
                    'Monitor for follow-up requests after successful information disclosure',
                    'Look for attempts to access backup files (.bak, .old, etc.)'
                ],
                security_context: 'Configuration files contain sensitive information including database credentials, API keys, and system paths. Any access attempts should be investigated immediately.'
            };
        }
        
        if (url.includes('wp-admin') || url.includes('wp-login') || url.includes('admin')) {
            return {
                severity: 'HIGH',
                pattern_type: 'Administrative Interface Probe',
                description: baseAnalysis,
                attack_vector: 'Brute Force / Credential Stuffing',
                intent: 'Unauthorized administrative access',
                frequency_analysis: 'High frequency indicates brute force attempts, sporadic access may be reconnaissance',
                related_indicators: [
                    'Monitor for failed authentication attempts',
                    'Check User-Agent patterns for bot-like behavior',
                    'Look for successful logins followed by suspicious activity'
                ],
                security_context: 'Administrative interfaces are high-value targets. Monitor authentication logs and implement account lockout policies.'
            };
        }
        
        if (url.includes('.well-known') || url.includes('robots.txt') || url.includes('sitemap')) {
            return {
                severity: 'LOW',
                pattern_type: 'Information Gathering',
                description: baseAnalysis,
                attack_vector: 'Reconnaissance',
                intent: 'Site structure mapping and service discovery',
                frequency_analysis: 'Normal for search engines and legitimate crawlers, suspicious if combined with other probing activities',
                related_indicators: [
                    'Check for subsequent vulnerability scanning attempts',
                    'Verify User-Agent against legitimate crawler databases',
                    'Monitor for directory traversal attempts after reconnaissance'
                ],
                security_context: 'These are often legitimate requests from search engines, but can be part of reconnaissance phase of an attack.'
            };
        }
        
        return {
            severity: 'MEDIUM',
            pattern_type: 'General Access Pattern',
            description: baseAnalysis,
            attack_vector: 'Various',
            intent: 'Requires pattern analysis to determine intent',
            frequency_analysis: 'Monitor request frequency and timing patterns for automation indicators',
            related_indicators: [
                'Analyze User-Agent consistency',
                'Check request timing patterns',
                'Monitor response size patterns'
            ],
            security_context: 'Standard web request that requires behavioral analysis to determine legitimate vs. malicious intent.'
        };
    }

    function findLogEntriesByIP(ip) {
        // In a real implementation, this would search through actual log data
        // For demo purposes, return simulated data based on IP patterns
        return {
            total_requests: Math.floor(Math.random() * 100) + 10,
            unique_urls: Math.floor(Math.random() * 20) + 5,
            time_span: '2h 35m',
            first_seen: '2025-08-24 10:15:32',
            last_seen: '2025-08-24 12:50:14'
        };
    }

    function analyzeRequestPatterns(entries) {
        // Simulate pattern analysis
        const suspiciousPatterns = [];
        const topUrls = [
            {path: '/wp-login.php', count: 45},
            {path: '/admin/', count: 23},
            {path: '/.env', count: 12},
            {path: '/wp-admin/', count: 8}
        ];
        
        // Add suspicious indicators based on URLs
        if (topUrls.some(url => url.path.includes('wp-login'))) {
            suspiciousPatterns.push({
                type: 'WordPress Brute Force Pattern',
                description: 'High frequency WordPress login attempts detected',
                severity: 'HIGH'
            });
        }
        
        if (topUrls.some(url => url.path.includes('.env'))) {
            suspiciousPatterns.push({
                type: 'Configuration File Access',
                description: 'Attempts to access sensitive configuration files',
                severity: 'HIGH'
            });
        }
        
        return {
            total_requests: entries.total_requests,
            time_span: entries.time_span,
            success_rate: Math.floor(Math.random() * 30) + 10, // Low success rate indicates scanning
            top_urls: topUrls,
            suspicious_patterns: suspiciousPatterns
        };
    }

    function generateSampleLogEntries(url) {
        const baseUrl = url;
        const entries = [];
        
        // Generate realistic log entries based on URL type
        if (url.includes('wp-login')) {
            entries.push({
                log_line: '108.162.216.144 - - [24/Aug/2025:00:14:53 +0000] "POST /wp-login.php HTTP/1.1" 200 1234 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"',
                analysis: 'WordPress login attempt via POST - legitimate method but monitor frequency'
            });
            entries.push({
                log_line: '108.162.216.144 - - [24/Aug/2025:00:14:55 +0000] "POST /wp-login.php HTTP/1.1" 200 1234 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"',
                analysis: 'Rapid successive login attempts from same IP - potential brute force indicator'
            });
        } else if (url.includes('.env')) {
            entries.push({
                log_line: '172.69.151.214 - - [24/Aug/2025:00:14:54 +0000] "GET /.env HTTP/1.1" 404 25157 "-" "Mozilla/5.0 (compatible; scanner/1.0)"',
                analysis: 'CRITICAL: Environment file access attempt - 404 response indicates file protection is working'
            });
        } else if (url.includes('wp-cron')) {
            entries.push({
                log_line: '108.162.216.144 - - [24/Aug/2025:00:14:53 +0000] "POST /wp-cron.php?doing_wp_cron=1755994493.5390698909759521484375 HTTP/2.0" 200 20 "-" "WordPress/6.8.2; https://nzlmra.nz"',
                analysis: 'WordPress cron job - User-Agent indicates legitimate WordPress site making scheduled requests'
            });
        } else {
            entries.push({
                log_line: `192.168.1.100 - - [24/Aug/2025:00:15:23 +0000] "GET ${url} HTTP/1.1" 404 1234 "-" "Mozilla/5.0"`,
                analysis: 'Standard 404 error - monitor for patterns indicating scanning behavior'
            });
        }
        
        return entries;
    }

    function createAnalysisModal(title, content) {
        const modal = document.createElement('div');
        modal.className = 'modal fade show';
        modal.style.display = 'block';
        modal.style.backgroundColor = 'rgba(0,0,0,0.5)';
        
        modal.innerHTML = `
            <div class="modal-dialog modal-lg modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">${title}</h5>
                        <button type="button" class="btn-close" onclick="this.closest('.modal').remove()"></button>
                    </div>
                    <div class="modal-body">
                        ${content}
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="this.closest('.modal').remove()">Close</button>
                        <button type="button" class="btn btn-primary" onclick="copyAnalysisToClipboard(this)">Copy Analysis</button>
                    </div>
                </div>
            </div>
        `;
        
        return modal;
    }

    function copyAnalysisToClipboard(button) {
        const modalBody = button.closest('.modal').querySelector('.modal-body');
        const text = modalBody.innerText;
        navigator.clipboard.writeText(text).then(() => {
            const originalText = button.textContent;
            button.textContent = 'Copied!';
            setTimeout(() => {
                button.textContent = originalText;
            }, 2000);
        });
    }

    function printReport() {
        window.print();
    }

    function exportData() {
        const modal = createAnalysisModal('Export Analysis Data', `
            <div class="export-options">
                <h6><i class="fas fa-download"></i> Available Export Formats</h6>
                <div class="row">
                    <div class="col-md-6">
                        <div class="export-option" onclick="exportFormat('csv')">
                            <i class="fas fa-file-csv fa-2x text-success"></i>
                            <h6>CSV Export</h6>
                            <p>Structured data for spreadsheet analysis</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="export-option" onclick="exportFormat('json')">
                            <i class="fas fa-file-code fa-2x text-primary"></i>
                            <h6>JSON Export</h6>
                            <p>Raw data for programmatic analysis</p>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="export-option" onclick="exportFormat('pdf')">
                            <i class="fas fa-file-pdf fa-2x text-danger"></i>
                            <h6>PDF Report</h6>
                            <p>Professional report for documentation</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="export-option" onclick="exportFormat('siem')">
                            <i class="fas fa-shield-alt fa-2x text-warning"></i>
                            <h6>SIEM Format</h6>
                            <p>Security information and event management integration</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <style>
                .export-option {
                    border: 1px solid #dee2e6;
                    border-radius: 8px;
                    padding: 1rem;
                    text-align: center;
                    cursor: pointer;
                    transition: all 0.2s;
                    margin-bottom: 1rem;
                }
                .export-option:hover {
                    border-color: #007bff;
                    background-color: #f8f9fa;
                }
            </style>
        `);
        
        document.body.appendChild(modal);
    }

    function exportFormat(format) {
        alert(`Export to ${format.toUpperCase()} format:\n\nThis would generate analysis data in ${format} format for further processing and integration with security tools.\n\nFeature available in full implementation.`);
    }

    function fixSuggestion(url) {
        const analysis = getURLThreatAnalysis(url);
        
        const modal = createAnalysisModal('Security Analysis & Monitoring Recommendations', `
            <div class="fix-suggestions">
                <h5><i class="fas fa-tools"></i> Monitoring Recommendations for <code>${url}</code></h5>
                
                <div class="alert alert-info">
                    <h6><i class="fas fa-info-circle"></i> Analysis Focus</h6>
                    <p>These recommendations focus on <strong>log analysis and pattern detection</strong> rather than infrastructure changes.</p>
                </div>
                
                <h6><i class="fas fa-search"></i> Detection & Monitoring</h6>
                <div class="monitoring-recommendations">
                    <div class="recommendation-item">
                        <h6>Pattern Analysis</h6>
                        <ul>
                            <li>Monitor request frequency from individual IPs</li>
                            <li>Analyze timing patterns for automation indicators</li>
                            <li>Track User-Agent consistency across requests</li>
                            <li>Correlate with similar requests from different IPs</li>
                        </ul>
                    </div>
                    
                    <div class="recommendation-item">
                        <h6>Behavioral Indicators</h6>
                        <ul>
                            <li>Look for rapid successive requests (< 1 second intervals)</li>
                            <li>Monitor for requests outside business hours</li>
                            <li>Detect unusual geographic request patterns</li>
                            <li>Identify consistent response sizes indicating scripted access</li>
                        </ul>
                    </div>
                    
                    <div class="recommendation-item">
                        <h6>Log Correlation</h6>
                        <ul>
                            <li>Cross-reference with authentication logs</li>
                            <li>Correlate with firewall and intrusion detection logs</li>
                            <li>Monitor for follow-up requests after error responses</li>
                            <li>Track session persistence and cookie behavior</li>
                        </ul>
                    </div>
                </div>
                
                <h6><i class="fas fa-exclamation-triangle"></i> Alert Thresholds</h6>
                <div class="alert-thresholds">
                    <div class="row">
                        <div class="col-md-6">
                            <strong>Frequency Alerts:</strong>
                            <ul>
                                <li>More than 50 requests/minute from single IP</li>
                                <li>More than 10 failed attempts in 5 minutes</li>
                                <li>Unusual request timing patterns</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <strong>Pattern Alerts:</strong>
                            <ul>
                                <li>Multiple admin interface probes</li>
                                <li>Configuration file access attempts</li>
                                <li>Suspicious User-Agent strings</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <h6><i class="fas fa-chart-line"></i> Analysis Techniques</h6>
                <div class="analysis-techniques">
                    <p><strong>Statistical Analysis:</strong> Use standard deviation to identify outliers in request patterns</p>
                    <p><strong>Time Series Analysis:</strong> Look for periodicity that indicates automated tools</p>
                    <p><strong>Geolocation Analysis:</strong> Identify requests from suspicious or unexpected locations</p>
                    <p><strong>User Agent Analysis:</strong> Cross-reference against known bot/scanner signatures</p>
                </div>
            </div>
            
            <style>
                .recommendation-item {
                    background: #f8f9fa;
                    border-left: 4px solid #007bff;
                    padding: 1rem;
                    margin: 1rem 0;
                }
                .analysis-techniques p {
                    margin: 0.5rem 0;
                    padding: 0.5rem;
                    background: #e9ecef;
                    border-radius: 4px;
                }
            </style>
        `);
        
        document.body.appendChild(modal);
    }
</script>

</body>
</html>